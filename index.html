<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Radetzky FM</title>
  <link rel="manifest" href="manifest.json">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="Radetzky FM">
  <link rel="apple-touch-icon" href="icons/icon-192.png">

  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden;
      font-family: sans-serif;
    }

    body {
      background: linear-gradient(to bottom, #001a4d, #003366);
    }

    .title {
      font-size: 2rem;
      color: white;
      position: absolute;
      top: 1rem;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.5);
      border-radius: 10px;
      padding: 10px;
      z-index: 2;
      white-space: nowrap;
    }

    .settings-buttons-container {
  position: absolute;
  bottom: 0.5cm;
  left: 50%;
  transform: translateX(-50%);
  z-index: 3;
  display: flex;
  gap: 20px; /* t√°vols√°g a gombok k√∂z√∂tt */
}

.settings-button,
.settings-button1 {
  background: rgba(255, 255, 255, 0.85);
  border: none;
  border-radius: 8px;
  padding: 10px 20px;
  font-size: 16px;
  cursor: pointer;
  font-family: sans-serif;
}


    .settings-panel {
      position: absolute;
      bottom: 4.1cm;
      left: 50%;
      transform: translateX(-50%);
      width: 90%;
      max-width: 400px;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 8px;
      padding: 15px;
      z-index: 4;
      display: none;
      font-family: sans-serif;
    }

    .settings-panel label {
      display: block;
      margin-top: 10px;
      font-weight: bold;
    }

    .settings-panel select,
    .settings-panel input {
      width: 100%;
      margin-top: 5px;
      padding: 5px;
      border-radius: 5px;
      border: 1px solid #aaa;
    }

    .settings-panel .close-btn {
      margin-top: 10px;
      background: #003366;
      color: white;
      border: none;
      padding: 8px;
      border-radius: 5px;
      cursor: pointer;
      width: 100%;
    }

    audio {
      position: absolute;
      bottom: 2cm;
      left: 50%;
      transform: translateX(-50%);
      width: 90%;
      max-width: 400px;
      z-index: 2;
      background: rgba(255, 255, 255, 0.85);
      border-radius: 8px;
      padding: 10px;
    }

    .metadata-box {
  position: absolute;
  bottom: 4.1cm;
  left: 50%;
  transform: translateX(-50%);
  width: 90%;
  max-width: 400px;
  background: rgba(255, 255, 255, 0.85);
  border-radius: 8px;
  padding: 10px;
  text-align: center;
  font-family: sans-serif;
  z-index: 2;
  color: #000;
  display: none; /* alapb√≥l rejtve */
}


    .background {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 1;
    }

    .symbol {
      position: absolute;
      font-size: 20px;
      opacity: 0.8;
      color: rgba(255, 255, 255, 0.7);
      animation: float linear infinite;
    }

    @keyframes float {
      from {
        transform: translate(var(--start-x), var(--start-y));
        opacity: 1;
      }
      to {
        transform: translate(var(--end-x), var(--end-y));
        opacity: 0;
      }
    }
  </style>
</head>
<body>
  <div class="title">Radetzky FM</div>

  <!-- üéõÔ∏è T√©ma gomb -->
  

  <!-- ‚öôÔ∏è Be√°ll√≠t√°si panel -->
  <div class="settings-panel" id="settingsPanel">
    <label for="bg-select">H√°tt√©r sz√≠ne:</label>
<select id="bg-select">
  <option value="blue">K√©k</option>
  <option value="purple">Lila-r√≥zsasz√≠n</option>
  <option value="green">Z√∂ld</option>
  <option value="redorange">Piros-narancs</option>
  <option value="sunset">Naplemente</option>
  <option value="aqua">Akvamarin</option>
  <option value="midnight">√âjf√©li k√©k</option>
  <option value="gray">Sz√ºrke</option>
</select>

    <button class="close-btn" onclick="toggleMetadata()">Zeneinform√°ci√≥ Be-KI</button>


    

    <button class="close-btn" onclick="toggleSettings()">‚ùå</button>
  </div>

  


  <div class="settings-panel" id="settingsPanel1">
    <label for="b1g-select"V√°lasszon:</label>
<button class="close-btn" onclick="location.reload()">App √∫jrat√∂lt√©se</button>
      <button class="close-btn" onclick="function fetchStreamTitle()">Zeneinf√≥ √∫jrat√∂lt√©se</button>
      <button class="close-btn" onclick="fixAudioPlayer()">Lej√°tsz√≥ √∫jrat√∂lt√©se</button>


    

    <button class="close-btn" onclick="toggleSettings1()">‚ùå</button>
  </div>

  <div class="settings-buttons-container">
  <button class="settings-button" onclick="toggleSettings()">T√©ma</button>
  <button class="settings-button1" onclick="toggleSettings1()">Friss√≠t</button>
</div>


<div class="metadata-box" id="metadataBox">
  <div id="dynamic-title">Bet√∂lt√©s...</div>
</div>

  <audio controls autoplay>
    <source src="https://katolikusradio.hu:8001/radetzkyfm" type="audio/mpeg">
    A b√∂ng√©sz≈ëd nem t√°mogatja az audi√≥lej√°tsz√°st.
  </audio>

  <div class="background" id="background"></div>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>

   function toggleMetadata() {
  const box = document.getElementById('metadataBox');
  if (!box) {
    console.error('Nem tal√°lhat√≥ a metadataBox elem!');
    return;
  }
  box.style.display = (box.style.display === 'none' || box.style.display === '') ? 'block' : 'none';
}




    if ('serviceWorker' in navigator && 'Notification' in window) {
  navigator.serviceWorker.register('/sw.js').then(reg => {
    console.log('Service Worker regisztr√°lva', reg);

    // K√©rj√ºk az √©rtes√≠t√©si enged√©lyt
    Notification.requestPermission().then(permission => {
      if(permission === 'granted') {
        console.log('√ârtes√≠t√©si enged√©ly megadva');

        // K√ºldj√ºnk egy kezd≈ë √©rtes√≠t√©st (opcion√°lis)
        

        // Ind√≠tsuk el az id≈ëz√≠t≈ët 30 percre a SW-on bel√ºl
        reg.active.postMessage({command: 'start-notifications'});
      } else {
        console.log('√ârtes√≠t√©si enged√©ly megtagadva');
      }
    });
  }).catch(e => console.error('Service Worker regisztr√°ci√≥ sikertelen', e));

  // √úzenetek fogad√°sa a SW-t≈ël (opcion√°lis)
  navigator.serviceWorker.addEventListener('message', event => {
    console.log('SW √ºzenet:', event.data);
  });
} else {
  console.log('Service Worker vagy Notification API nem t√°mogatott');
}



    let audio = null;

    

function fixAudioPlayer() {
  const audioElement = document.querySelector("audio");

  if (!audioElement) {
    alert("Nem tal√°lhat√≥ audioelem.");
    return;
  }

  // √Åll√≠tsuk le, √ºr√≠ts√ºk ki, majd √∫jrat√∂lt√©s √©s √∫jraind√≠t√°s
  audioElement.pause();
  audioElement.src = "https://katolikusradio.hu:8001/radetzkyfm";
  audioElement.load();

  audioElement.play().then(() => {
    console.log("Lej√°tsz√≥ √∫jrat√∂ltve √©s elind√≠tva.");
  }).catch(err => {
    console.error("Hiba a lej√°tsz√≥ √∫jraind√≠t√°sakor:", err);
    alert("Nem siker√ºlt √∫jraind√≠tani a hangot. Koppints √∫jra.");
  });
}


    function resumeAudio() {
  if (audioElement.paused) {
    audioElement.play().catch((e) => console.warn("Audio error:", e));
  }
}

    async function runAndReload() {
    await fetchStreamTitle();  // Megv√°rja, hogy lefusson
    location.reload();         // Csak ut√°na friss√≠t
  }
    
    let symbolsSet = [' ', ' ', ' '];
    let symbolSpawnInterval = 30000;
    let spawnIntervalId;

    function toggleSettings() {
      const panel = document.getElementById('settingsPanel');
      panel.style.display = panel.style.display === 'block' ? 'none' : 'block';
    }
function toggleSettings1() {
      const panel = document.getElementById('settingsPanel1');
      panel.style.display = panel.style.display === 'block' ? 'none' : 'block';
    }
    
    function applySettings() {
      const bgValue = document.getElementById('bg-select').value;
      const body = document.body;

      switch (bgValue) {
  case 'purple':
    body.style.background = 'linear-gradient(to bottom, #4b006e, #cc3399)';
    break;
  case 'green':
    body.style.background = 'linear-gradient(to bottom, #004d00, #339966)';
    break;
  case 'redorange':
    body.style.background = 'linear-gradient(to bottom, #ff3300, #ff9900)';
    break;
  case 'sunset':
    body.style.background = 'linear-gradient(to bottom, #ff9966, #ff5e62)';
    break;
  case 'aqua':
    body.style.background = 'linear-gradient(to bottom, #00c6ff, #0072ff)';
    break;
  case 'midnight':
    body.style.background = 'linear-gradient(to bottom, #232526, #414345)';
    break;
  case 'gray':
    body.style.background = 'linear-gradient(to bottom, #666666, #cccccc)';
    break;
  default:
    body.style.background = 'linear-gradient(to bottom, #001a4d, #003366)';
}

      function applySettings1() {
  const bgValue = document.getElementById('b1g-select').value;
  const body = document.body;

  switch (bgValue) {
    case 'remeta':
      fetchStreamTitle();
      break;
    case 'reweb':
      location.reload();
      break;
  }
}



      const symbolType = document.getElementById('symbol-select').value;
      switch (symbolType) {
        case 'stars':
          symbolsSet = ['‚òÖ', '‚ú¶', '‚úß'];
          break;
        case 'notes':
          symbolsSet = ['‚ô™', '‚ô´', '‚ô¨'];
          break;
        default:
          symbolsSet = [' ', ' ', ' '];
      }

      const newInterval = parseInt(document.getElementById('spawn-interval').value);
      if (!isNaN(newInterval) && newInterval >= 1000) {
        clearInterval(spawnIntervalId);
        symbolSpawnInterval = newInterval;
        spawnIntervalId = setInterval(createSymbol, symbolSpawnInterval);
      }
    }

    $(document).ready(function () {
      const proxyUrl = "https://api.allorigins.win/get?url=" + encodeURIComponent("http://katolikusradio.hu:9000/status-json.xsl");

      function fetchStreamTitle() {
  $.getJSON(proxyUrl, function(response) {
    try {
      console.log('Proxy response:', response);
      const data = JSON.parse(response.contents);
      console.log('Parsed data:', data);
      let sources = data.icestats.source;
      let stream = null;

      if (Array.isArray(sources)) {
        stream = sources.find(s => s.server_name === "Radetzky Fm");
      } else if (sources.server_name === "Radetzky Fm") {
        stream = sources;
      }

      if (stream && stream.title) {
        $("#dynamic-title").text(stream.title);
      } else if (!stream) {
        $("#dynamic-title").text("--");
      } else {
        $("#dynamic-title").text("Nincs aktu√°lis c√≠m");
      }
    } catch (e) {
      console.error('JSON parse error:', e);
      $("#dynamic-title").text("--");
    }
  }).fail(function() {
    console.error('AJAX request failed');
    $("#dynamic-title").text("--");
  });
}


      fetchStreamTitle();
      setInterval(fetchStreamTitle, 10000);

      document.getElementById('bg-select').addEventListener('change', applySettings);
      document.getElementById('symbol-select').addEventListener('change', applySettings);
      document.getElementById('spawn-interval').addEventListener('change', applySettings);
    });

    const background = document.getElementById('background');

    function createSymbol() {
      const symbol = document.createElement('div');
      symbol.classList.add('symbol');
      symbol.textContent = symbolsSet[Math.floor(Math.random() * symbolsSet.length)];

      const startX = Math.random() * window.innerWidth + 'px';
      const startY = Math.random() * window.innerHeight + 'px';
      const endX = Math.random() * window.innerWidth + 'px';
      const endY = Math.random() * window.innerHeight + 'px';

      symbol.style.setProperty('--start-x', startX);
      symbol.style.setProperty('--start-y', startY);
      symbol.style.setProperty('--end-x', endX);
      symbol.style.setProperty('--end-y', endY);

      const size = Math.random() * 20 + 10;
      const duration = Math.random() * 10 + 5;
      symbol.style.fontSize = `${size}px`;
      symbol.style.animationDuration = `${duration}s`;

      background.appendChild(symbol);
      symbol.addEventListener('animationend', () => background.removeChild(symbol));
    }

    spawnIntervalId = setInterval(createSymbol, symbolSpawnInterval);
   
  </script>
</body>
</html>
