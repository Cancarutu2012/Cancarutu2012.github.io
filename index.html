<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Időjárás</title>
  <style>
    body {
      font-family: monospace, monospace;
      background-color: #fff;
      color: #0f0;
      white-space: pre;
      padding: 20px;
      max-width: 600px;
      margin: auto;
    }
    input[type="text"] {
      font-family: monospace;
      font-size: 1rem;
      padding: 8px;
      width: 80%;
      background: #fff;
      color: #0f0;
      border: 1px solid #0f0;
    }
    button {
      font-family: monospace;
      background: #0f0;
      color: #000;
      border: none;
      padding: 8px 12px;
      cursor: pointer;
      margin-left:38px;
      transform: translateX(-1cm);
    }
    #weather {
      margin-top: 20px;
      border: 2px solid #0f0;	
      padding: 15px;
      background-color: #fff;
    }
    .icon {
      width: 64px;
      height: 64px;
      vertical-align: middle;
      display: block;
      margin-bottom: 10px;
    }
    details {
      margin-bottom: 20px;
    }
    summary {
      font-size: 1.2rem;
      cursor: pointer;
      color: #000;
    }
  </style>
</head>
<body>

<h1>Időjárás</h1>

<details>
  <summary>Keresés város szerint</summary>
  <br />
  <label for="cityInput">Város megadása: </label><br />
  <input id="cityInput" type="text" placeholder="pl. Budapest" />
  <button id="searchBtn">Keresés</button>
</details>

<div id="weather">Várakozás helyadatokra vagy város megadására...</div>

<script>
  const apiKey = "4c17dc1b78143587b881081c7ee1a272";
  const weatherDiv = document.getElementById("weather");
  const cityInput = document.getElementById("cityInput");
  const searchBtn = document.getElementById("searchBtn");

  function getSvgIconPath(weatherId) {
    if (weatherId >= 200 && weatherId < 300) return "icons/lightning.svg";
    if (weatherId >= 300 && weatherId < 400) return "icons/drizzle.svg";
    if (weatherId >= 500 && weatherId < 600) return "icons/rain.svg";
    if (weatherId >= 600 && weatherId < 700) return "icons/snow.svg";
    if (weatherId >= 700 && weatherId < 800) return "icons/fog.svg";
    if (weatherId === 800) return "icons/sun.svg";
    if (weatherId === 801) return "icons/cloud-sun.svg";
    if (weatherId === 802 || weatherId === 803 || weatherId === 804) return "icons/cloud.svg";
    return "icons/question.svg";
  }

  async function fetchWeather(city) {
    try {
      weatherDiv.textContent = "Betöltés...";
      const url = `https://api.openweathermap.org/data/2.5/weather?q=${encodeURIComponent(city)}&appid=${apiKey}&units=metric&lang=hu`;
      const res = await fetch(url);
      if (!res.ok) throw new Error("Nem sikerült lekérni az adatokat");
      const data = await res.json();

      if (data.cod !== 200) {
        weatherDiv.textContent = `Hiba: ${data.message}`;
        return;
      }

      const w = data.weather[0];
      const main = w.main;
      const desc = w.description;
      const iconPath = getSvgIconPath(w.id);

      const output = `
Időjárás – ${data.name}, ${data.sys.country}
───────────────────────────────
Állapot     : ${main} (${desc})
Hőmérséklet : ${data.main.temp} °C
Hőérzet     : ${data.main.feels_like} °C
Páratartalom: ${data.main.humidity}%
Szélsebesség: ${data.wind.speed} m/s
───────────────────────────────
`;

      weatherDiv.innerHTML = `<img src="${iconPath}" alt="Időjárás ikon" class="icon"><pre>${output}</pre>`;
    } catch (err) {
      weatherDiv.textContent = "Hiba történt a lekérés során.";
      console.error(err);
    }
  }

  function getLocationAndFetch() {
    if (!navigator.geolocation) {
      weatherDiv.textContent = "A böngésző nem támogatja a helymeghatározást. Kérlek, adj meg egy várost!";
      return;
    }
    weatherDiv.textContent = "Helyzet meghatározása...";
    navigator.geolocation.getCurrentPosition(async (pos) => {
      const lat = pos.coords.latitude;
      const lon = pos.coords.longitude;
      try {
        const url = `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${apiKey}&units=metric&lang=hu`;
        const res = await fetch(url);
        if (!res.ok) throw new Error("Nem sikerült lekérni az adatokat");
        const data = await res.json();
        if (data.cod !== 200) {
          weatherDiv.textContent = `Hiba: ${data.message}`;
          return;
        }

        const w = data.weather[0];
        const main = w.main;
        const desc = w.description;
        const iconPath = getSvgIconPath(w.id);

        const output = `
Időjárás – ${data.name}, ${data.sys.country}
───────────────────────────────
Állapot     : ${main} (${desc})
Hőmérséklet : ${data.main.temp} °C
Hőérzet     : ${data.main.feels_like} °C
Páratartalom: ${data.main.humidity}%
Szélsebesség: ${data.wind.speed} m/s
───────────────────────────────
`;

        weatherDiv.innerHTML = `<img src="${iconPath}" alt="Időjárás ikon" class="icon"><pre>${output}</pre>`;
      } catch (err) {
        weatherDiv.textContent = "Hiba történt a lekérés során.";
        console.error(err);
      }
    }, () => {
      weatherDiv.textContent = "Nem sikerült meghatározni a helyzetet. Kérlek, adj meg egy várost!";
    });
  }

  getLocationAndFetch();

  searchBtn.addEventListener("click", () => {
    const city = cityInput.value.trim();
    if (city) {
      fetchWeather(city);
    } else {
      alert("Kérlek, adj meg egy várost!");
    }
  });
</script>

</body>
</html>
